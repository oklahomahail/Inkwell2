/* Import New Inkwell Brand Fonts */
@import url('https://fonts.googleapis.com/css2?family=Source+Serif+Pro:wght@400;600;700&family=Inter:wght@400;500;600;700&display=swap');

/* Import Professional Design System */
@import url('./styles/design-system.css');
@import url('./styles/tour.css');

@tailwind base;
@tailwind components;
@tailwind utilities;

/* ============================================================================
   THEME BASE COLORS - PREVENT FLASH
   ============================================================================
   Ensure base colors come from [data-theme] without waiting on JS.
   Light is the default theme, dark requires explicit opt-in.
*/
:root,
[data-theme='light'] {
  color-scheme: light;
}

:root.dark,
[data-theme='dark'] {
  color-scheme: dark;
}

/* Inkwell Brand CSS Variables - Light Theme Only */
@layer base {
  :root {
    --font-serif: 'Source Serif Pro', ui-serif, georgia, serif;
    --font-sans: 'Inter', ui-sans-serif, system-ui, sans-serif;

    /* Legacy Brand Colors (kept for compatibility) */
    --color-navy: #0c1c3d;
    --color-gold: #d4a537;
    --color-charcoal: #222;
    --color-paper: #fff;

    /* Text hierarchy */
    --ink-fg: #0c1c3d;
    --ink-fg-muted: #475569;
    --ink-bg: #fff;
    --ink-paper: #fff;

    /* New Brand Blue Scale (roughly Tailwind blue-600 family) */
    --ink-50: 214 95% 98%;
    --ink-100: 213 96% 93%;
    --ink-200: 214 95% 87%;
    --ink-300: 213 94% 82%;
    --ink-400: 217 91% 66%;
    --ink-500: 221 83% 53%; /* main brand blue */
    --ink-600: 224 76% 48%;
    --ink-700: 226 71% 40%;
    --ink-800: 224 64% 33%;
    --ink-900: 227 58% 25%;

    /* Feather gold */
    --gold-400: 43 96% 56%;
    --gold-500: 41 96% 50%;

    /* Surfaces & text (light mode) */
    --surface-0: 0 0% 100%;
    --surface-1: 210 20% 99%;
    --surface-2: 210 20% 98%;
    --surface-3: 210 18% 96%;
    --surface-inverse: 0 0% 10%;
    --text-1: 222 47% 11%;
    --text-2: 215 16% 42%;
    --text-inverse: 0 0% 100%;
    --border-subtle: 214 15% 90%;
    --border-strong: 215 20% 84%;
    --shadow-subtle: 220 14% 96% / 0.6;
    --ring: 221 83% 53%;
  }

  /* Dark mode variables */
  .dark {
    --surface-0: 225 14% 12%;
    --surface-1: 225 14% 14%;
    --surface-2: 225 14% 16%;
    --surface-3: 225 14% 18%;
    --surface-inverse: 0 0% 100%;
    --text-1: 210 20% 98%;
    --text-2: 214 14% 74%;
    --text-inverse: 222 47% 11%;
    --border-subtle: 225 10% 22%;
    --border-strong: 225 10% 28%;
    --shadow-subtle: 225 10% 8% / 0.7;
  }
}

/* Brand Component Utilities */
@layer components {
  /* Header: thin brand top-border or soft gradient */
  .ink-header {
    @apply border-b;

    background-color: hsl(var(--surface-2));
    box-shadow: 0 1px 0 0 hsl(var(--shadow-subtle));
    border-color: hsl(var(--border-subtle));
    background-image: linear-gradient(
      to right,
      hsl(var(--ink-50)),
      white 25%,
      white 75%,
      hsl(var(--ink-50))
    );
    background-size: 100% 100%;
  }

  .ink-header--simple {
    @apply border-b-2;

    background-color: hsl(var(--surface-2));
    border-color: hsl(var(--ink-500));
    background-image: none;
  }

  /* Sidebar base */
  .ink-sidebar {
    @apply border-r;

    background-color: hsl(var(--surface-2));
    color: hsl(var(--text-2));
    border-color: hsl(var(--border-subtle));
  }

  /* Nav items */
  .ink-nav-item {
    @apply flex items-center gap-3 rounded-xl px-3 py-2;

    color: hsl(var(--text-2));
  }

  .ink-nav-item:hover {
    background-color: hsl(var(--ink-50));
    color: hsl(var(--ink-700));
  }

  .ink-nav-item--active {
    @apply font-medium;

    background-color: hsl(var(--ink-50));
    color: hsl(var(--ink-700));
  }

  .ink-nav-icon {
    @apply h-4 w-4;

    color: hsl(var(--ink-600));
  }

  .ink-nav-icon--active {
    color: hsl(var(--ink-700));
  }

  /* Primary button aligns with brand */
  .ink-btn {
    @apply inline-flex items-center justify-center rounded-lg px-3 py-2 text-white focus-visible:outline-none focus-visible:ring-2;

    background-color: hsl(var(--ink-600));

    --tw-ring-color: hsl(var(--ring) / 60%);
  }

  .ink-btn:hover {
    background-color: hsl(var(--ink-700));
  }

  .ink-btn-outline {
    @apply inline-flex items-center justify-center rounded-lg px-3 py-2 bg-white border focus-visible:outline-none focus-visible:ring-2;

    color: hsl(var(--ink-700));
    border-color: hsl(var(--ink-200));

    --tw-ring-color: hsl(var(--ring) / 60%);
  }

  .ink-btn-outline:hover {
    background-color: hsl(var(--ink-50));
  }
}

/* Global font fallback and base layout tweaks */
body {
  font-family: var(--font-sans);
  font-feature-settings: 'cv02', 'cv03', 'cv04', 'cv11';
  background-color: var(--color-paper);
  color: var(--ink-fg);
  line-height: 1.6;
}

/* Brand typography */
h1,
h2,
h3,
h4,
h5,
h6 {
  font-family: var(--font-serif);
  color: var(--ink-fg);
}

#root {
  min-height: 100vh;
  width: 100%;
}

/* Logo styling */
.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}

.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}

.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }

  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

/* Writing Editor Custom Prose Styling */
.prose {
  @apply bg-white text-gray-900;
}

.prose p {
  @apply text-gray-900;
}

.prose h1,
.prose h2,
.prose h3,
.prose h4,
.prose h5,
.prose h6 {
  @apply text-gray-900;
}

.prose strong {
  @apply text-gray-900;
}

.prose em {
  @apply text-gray-700;
}

.prose blockquote {
  @apply text-gray-700 border-gray-300;
}

.prose code {
  @apply text-gray-800 bg-gray-100;
}

/* Analytics Component Styles */

/* Add this to src/styles/components.css or src/index.css */

/* Analytics View Container */
.analytics-view {
  @apply max-w-full mx-auto p-6 space-y-8;
}

/* Analytics Header */
.analytics-header {
  @apply flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4;
}

.analytics-title {
  @apply text-3xl font-bold text-slate-900;
}

.analytics-subtitle {
  @apply text-lg text-slate-600;
}

.analytics-controls {
  @apply flex items-center gap-2;
}

.analytics-select {
  @apply px-3 py-2 bg-white border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500;
}

/* Analytics Cards Grid */
.analytics-metrics {
  @apply grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4;
}

.analytics-card {
  @apply bg-white rounded-lg border border-slate-200 p-4 transition-all duration-200 hover:shadow-md;
}

.analytics-card-header {
  @apply flex items-center gap-3 mb-3;
}

.analytics-card-icon {
  @apply p-2 rounded-lg bg-blue-50 text-blue-600;
}

.analytics-card-title {
  @apply text-sm font-medium text-slate-600;
}

.analytics-card-content {
  @apply flex items-end justify-between;
}

.analytics-card-value {
  @apply text-2xl font-bold text-slate-900;
}

.analytics-card-trend {
  @apply flex items-center gap-1 text-sm;
}

.analytics-card-trend.positive {
  @apply text-green-600;
}

.analytics-card-trend.negative {
  @apply text-red-600;
}

/* Special card styles */
.streak-card {
  @apply bg-gradient-to-r from-orange-50 to-red-50 border-orange-200;
}

.streak-card .analytics-card-icon {
  @apply bg-orange-100 text-orange-600;
}

.goal-complete {
  @apply bg-gradient-to-r from-green-50 to-emerald-50 border-green-200;
}

.goal-complete .analytics-card-icon {
  @apply bg-green-100 text-green-600;
}

/* Charts Section */
.analytics-charts {
  @apply grid grid-cols-1 lg:grid-cols-2 gap-6;
}

.analytics-chart-card {
  @apply bg-white rounded-lg border border-slate-200 p-6;
}

.chart-header {
  @apply mb-6;
}

.chart-header h3 {
  @apply text-lg font-semibold text-slate-900 mb-1;
}

.chart-header p {
  @apply text-sm text-slate-600;
}

.chart-container {
  @apply w-full;
}

/* Analytics Sections */
.analytics-section {
  @apply space-y-4;
}

.section-header {
  @apply mb-6;
}

.section-header h3 {
  @apply text-xl font-semibold text-slate-900 mb-1;
}

.section-header p {
  @apply text-slate-600;
}

/* Chapter Progress */
.chapter-progress-grid {
  @apply grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4;
}

.chapter-progress-card {
  @apply bg-white rounded-lg border border-slate-200 p-4;
}

.chapter-progress-header {
  @apply flex items-center justify-between mb-3;
}

.chapter-progress-header h4 {
  @apply font-medium text-slate-900 truncate;
}

.chapter-progress-percentage {
  @apply text-sm font-semibold text-blue-600;
}

.chapter-progress-bar {
  @apply w-full bg-slate-200 rounded-full h-2 mb-3;
}

.chapter-progress-fill {
  @apply bg-blue-600 h-2 rounded-full transition-all duration-500;
}

.chapter-progress-stats {
  @apply flex justify-between text-xs text-slate-600;
}

/* Writing Sessions */
.sessions-list {
  @apply space-y-3;
}

.session-item {
  @apply bg-white rounded-lg border border-slate-200 p-4 flex items-center justify-between;
}

.session-date {
  @apply flex items-center gap-2 text-sm text-slate-600;
}

.session-stats {
  @apply flex items-center gap-4;
}

.session-stat {
  @apply flex items-center gap-1 text-sm text-slate-600;
}

.session-productivity {
  @apply flex items-center gap-1 text-sm font-medium text-green-600;
}

/* Empty State */
.analytics-empty {
  @apply flex flex-col items-center justify-center py-16 text-center;
}

.analytics-empty-icon {
  @apply w-16 h-16 text-slate-400 mb-4;
}

.analytics-empty h2 {
  @apply text-xl font-semibold text-slate-900 mb-2;
}

.analytics-empty p {
  @apply text-slate-600;
}

/* =================== INKWELL BRAND UTILITIES =================== */
@layer utilities {
  /* Inkwell Motion Utilities */
  .transition-ink {
    @apply transition-all duration-200 ease-in-out;
  }

  .pulse-ink {
    animation: ink-pulse 1s ease-in-out infinite alternate;
  }

  .hover-ink {
    @apply transform transition-ink hover:scale-102;
  }

  .glow-ink {
    filter: drop-shadow(0 0 8px rgb(91 140 255 / 30%));
  }
}

@layer components {
  /* New Inkwell Brand Button Styles */
  .btn-inkwell-primary {
    @apply bg-inkwell-navy text-white px-4 py-2 rounded-lg font-medium transition-all duration-200 hover:bg-inkwell-gold focus:outline-none focus:ring-2 focus:ring-inkwell-gold focus:ring-offset-2;
  }

  .btn-inkwell-secondary {
    @apply border border-inkwell-navy text-inkwell-navy px-4 py-2 rounded-lg font-medium transition-all duration-200 hover:bg-inkwell-navy hover:text-white focus:outline-none focus:ring-2 focus:ring-inkwell-navy focus:ring-offset-2;
  }

  .btn-inkwell-gold {
    @apply bg-inkwell-gold text-inkwell-navy px-4 py-2 rounded-lg font-medium transition-all duration-200 hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-inkwell-gold focus:ring-offset-2;
  }

  /* New Inkwell Card Styles */
  .card-inkwell {
    @apply bg-white border border-gray-200 rounded-lg p-6 transition-all duration-200 hover:shadow-lg;
  }

  .card-inkwell-navy {
    @apply bg-inkwell-navy border border-inkwell-gold/20 rounded-lg p-6 transition-all duration-200 hover:shadow-lg text-white;
  }

  /* New Inkwell Text Styles */
  .text-inkwell-brand {
    @apply text-inkwell-navy font-serif font-semibold tracking-wide;
  }

  .text-inkwell-heading {
    @apply text-inkwell-navy font-serif font-semibold;
  }

  .text-inkwell-body {
    @apply text-inkwell-gray font-sans leading-relaxed;
  }

  .text-inkwell-gold {
    color: theme('colors.inkwell.gold');
    font-family: theme('fontFamily.serif');
    font-weight: theme('fontWeight.semibold');
  }

  /* Legacy Inkwell Button Styles (for backward compatibility) */
  .btn-ink-primary {
    @apply bg-ink-primary text-white px-4 py-2 rounded-lg font-medium transition-ink hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-ink-primary focus:ring-offset-2;
  }

  .btn-ink-secondary {
    @apply border border-ink-border bg-ink-surface text-ink-text px-4 py-2 rounded-lg font-medium transition-ink hover:bg-opacity-80 focus:outline-none focus:ring-2 focus:ring-ink-primary focus:ring-offset-2;
  }

  /* Legacy Inkwell Card Styles */
  .card-ink {
    @apply bg-ink-surface border border-ink-border rounded-lg p-6 transition-ink hover:shadow-lg;
  }

  /* Legacy Inkwell Text Styles */
  .text-ink-brand {
    @apply text-ink-primary font-display font-semibold tracking-wide;
  }

  .text-ink-heading {
    @apply text-ink-text font-display font-semibold;
  }

  .text-ink-body {
    @apply text-ink-text font-body leading-relaxed;
  }
}

/* Inkwell Brand Animations */
@keyframes ink-pulse {
  from {
    opacity: 0.5;
    transform: scale(1);
  }

  to {
    opacity: 1;
    transform: scale(1.02);
  }
}

@keyframes ink-fill {
  from {
    background-position: 0% 100%;
    opacity: 0;
  }

  to {
    background-position: 0% 0%;
    opacity: 1;
  }
}

@keyframes ink-spread {
  0% {
    transform: scale(0.8);
    opacity: 0;
  }

  50% {
    transform: scale(1.1);
    opacity: 0.6;
  }

  100% {
    transform: scale(1);
    opacity: 1;
  }
}

/* Inkwell Autosave Indicator */
.ink-save-pulse {
  animation: ink-pulse 1.5s ease-in-out;
}

/* Inkwell Loading Animation */
.ink-loading {
  animation: ink-fill 2s ease-in-out infinite;
  background: linear-gradient(180deg, #5b8cff 0%, transparent 100%);
  background-size: 100% 200%;
}

/* ============================================================================
   TOUR SYSTEM CRITICAL FIXES
   ============================================================================
   Ensures tour overlay renders properly and buttons remain clickable
*/

/* Ensure root and main containers don't clip the tour */
#root,
.AppShell,
main {
  overflow: visible !important;
}

/* Tour portal and overlay must be on top of everything */
#spotlight-root,
.tour-portal,
.tour-overlay,
.tour-popover,
[data-inkwell-spotlight-root] {
  position: fixed !important;
  z-index: 10000 !important;
  pointer-events: none !important;
}

/* Tour content should be interactive */
.tour-overlay > *,
.tour-popover > * {
  pointer-events: auto !important;
}

/* Header should not block the page */
.Topbar {
  position: sticky;
  top: 0;
  z-index: 30 !important;
}

/* Remove any pseudo overlays from topbar */
.Topbar::before,
.Topbar::after {
  content: none !important;
}

/* Main content pane should be above decorative layers */
.MainPane,
.main-content,
main[role='main'],
main[data-tour-id='dashboard'] {
  position: relative;
  z-index: 40 !important;
}

/* Decorative gradients and dormant backdrops never intercept clicks */
.branding-gradient,
.backdrop:not(.open),
.tour-backdrop:not(.open),
.overlay-gradient {
  pointer-events: none !important;
}

/* Ensure modals are below tour but above content */
[role='dialog']:not(.tour-overlay),
.modal-backdrop {
  z-index: 50 !important;
}

/* Tour-specific elements always on top */
[role='dialog'].tour-overlay,
[aria-label='Product tour'] {
  z-index: 10000 !important;
}

/* Defensive: Ensure inactive tour elements never block clicks */
.tour-overlay[aria-hidden='true'],
.tour-backdrop[aria-hidden='true'],
[data-inkwell-spotlight-root]:empty,
#spotlight-root:empty {
  pointer-events: none !important;
  display: none !important;
}

/* ============================================================================
   END TOUR FIXES
   ============================================================================ */

/* Spotlight Tour Styles
   ------------------------------------------------------------------- */
@layer components {
  .spotlight-header {
    @apply flex flex-col gap-1;
  }

  .spotlight-text {
    @apply text-sm leading-snug text-white mb-1;
  }

  .spotlight-progress {
    @apply text-xs text-slate-300 font-medium;
  }

  .spotlight-buttons {
    @apply flex gap-3 justify-end mt-3;
  }

  .spotlight-btn-next {
    @apply bg-inkwell-gold text-inkwell-blue font-semibold text-xs px-3 py-1.5 rounded-md hover:bg-yellow-400 transition;
  }

  .spotlight-btn-skip {
    @apply bg-transparent text-slate-300 text-xs px-2 py-1 hover:text-white underline-offset-2 hover:underline transition;
  }
}

#spotlight-overlay {
  @apply fixed rounded-xl pointer-events-none z-[9999] transition-all duration-200;

  box-shadow:
    0 0 0 2000px rgb(0 0 0 / 60%),
    0 0 0 2px #d4af37,
    0 0 20px 6px rgb(212 175 55 / 50%);
}
