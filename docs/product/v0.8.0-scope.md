# Inkwell v0.8.0 ‚Äî Scope Plan

**Branch Prefix:** `feat/v0.8.0-*`
**Timeline:** 3‚Äì4 weeks (target: mid‚Äìlate November 2025)
**Status:** Planning

---

## 1. North Star Themes

| Theme           | Intent                                                           |
| --------------- | ---------------------------------------------------------------- |
| ‚úçÔ∏è Author Flow  | Make writing, editing, and navigating chapters frictionless      |
| üíæ Reliability  | Harden persistence: autosave, sync, recovery                     |
| üìö Publishing   | Deliver professional-grade EPUB export and metadata              |
| üí° Intelligence | Expand AI context, cross-chapter insight, and timeline awareness |
| üß≠ Polish       | Improve onboarding, docs, and UX micro-interactions              |

---

## 2. Feature Pillars

### A. Chapter Editing Experience

**Goal:** Unify chapter creation, editing, and autosave into a fully fluid authoring experience.

**Scope:**

- Replace existing TipTap integration with `EnhancedChapterEditor` using local queue + debounce autosave
- Add inline word/character count indicator
- Integrate `useChapters()` CRUD hooks directly into `WritingPanel`
- Implement Conflict Resolver (detect stale local vs. remote)
- Add autosave status indicator in Topbar: "Saving‚Ä¶ / Saved / Offline"

**Acceptance Criteria:**

- Autosave triggers after 1s idle
- Remote sync verifies checksum before overwrite
- Local unsynced changes persist after browser restart
- Autosave status always visible and accurate

**Files:**

- `src/editor/EnhancedChapterEditor.tsx` (new)
- `src/services/autosaveService.ts` (new)
- `src/components/Topbar/AutosaveIndicator.tsx` (new)

---

### B. EPUB Export

**Goal:** Extend Export Dashboard with professional e-book output.

**Scope:**

- Create `epubService.ts` using `JSZip` + manifest builder
- Add EPUB option to Export Quick Actions
- Auto-generate metadata: title, author, ISBN (if present), cover image, TOC
- Validate EPUB structure (OPF, NCX, XHTML)
- Add E2E export test for EPUB file integrity

**Acceptance Criteria:**

- EPUB exports produce valid, loadable files
- Metadata editable in Project Settings
- Cover art auto-scaled and embedded
- Export tracked with `exportType: 'epub'` telemetry

**Files:**

- `src/services/epubService.ts` (new)
- `src/components/Dashboard/ExportDashboard.tsx` (update)
- `e2e/export-dashboard.spec.ts` (add EPUB tests)

**Dependencies:**

- `JSZip` library for ZIP file creation
- EPUB validation tooling (epubcheck integration)

---

### C. Enhanced AI Assistance

**Goal:** Contextual AI that understands project scope and cross-chapter consistency.

**Scope:**

- Integrate Claude streaming (ClaudeService 2.0)
- Add Chapter Summary Cache for AI awareness
- Enable "Ask Inkwell" shortcut (‚åò‚áßA) for contextual prompts
- Support inline AI rewrite and feedback side panel

**Acceptance Criteria:**

- AI assistant can summarize current and prior chapters
- Streaming responses update editor in real time
- Context includes up to 5 nearest chapters
- Logs tracked under `ai.query` events

**Files:**

- `src/services/ClaudeService.ts` (major refactor)
- `src/services/aiContextCache.ts` (new)
- `src/components/AI/InlineAssistant.tsx` (new)
- `src/hooks/useAIStreaming.ts` (new)

**Technical Notes:**

- Claude API supports streaming via SSE (Server-Sent Events)
- Chapter summaries cached in IndexedDB for performance
- Context window management to stay within token limits

---

### D. Timeline & Conflict Detection (v0.8.1 extension)

**Goal:** Visualize and correct temporal inconsistencies.

**Scope:**

- Add `TimelineInspector.tsx` modal showing chapter sequence and time references
- AI-assisted detection: "Possible timeline conflict between Chapter 3 and 7"
- Integrate with `useChapters()` metadata

**Acceptance Criteria:**

- Timeline view via ‚åòT
- Conflicts highlighted with direct editor links
- Exportable to CSV or Markdown

**Files:**

- `src/components/Timeline/TimelineInspector.tsx` (new)
- `src/services/timelineConflictDetection.ts` (new)
- `src/hooks/useTimeline.ts` (update)

**Note:** This extends existing timeline work from v0.7.x, adding AI-powered conflict detection.

---

### E. Onboarding & UX Polish

**Goal:** Ensure users can learn and trust the platform quickly.

**Scope:**

- Add Quick Tour V2 (3-step overlay on first launch)
- Add persistent Docs Drawer linked to `docs.inkwell.help`
- Enhance Command Palette discoverability ("?" overlay)
- Refine Tailwind design tokens for tooltips, modals, focus rings

**Acceptance Criteria:**

- Tour shows on first open and after reset
- All tooltips match dark/light theme tokens
- Command palette tracks 5 most recent commands
- 0 z-index or FOUC issues

**Files:**

- `src/components/Tour/QuickTourV2.tsx` (new)
- `src/components/Navigation/DocsDrawer.tsx` (new)
- `src/components/CommandPalette/CommandPaletteProvider.tsx` (update)
- `src/styles/tokens.css` (update)

---

## 3. Technical Deliverables

| Area              | File(s)                                | Description                                              |
| ----------------- | -------------------------------------- | -------------------------------------------------------- |
| Editor Engine     | `src/editor/EnhancedChapterEditor.tsx` | TipTap-based autosave editor with streaming AI hooks     |
| Persistence       | `src/services/autosaveService.ts`      | Queue-based local save with checksum + sync verification |
| EPUB              | `src/services/epubService.ts`          | Core EPUB builder + validator                            |
| Telemetry         | `src/services/telemetry.ts`            | Add `ai.query`, `autosave.event`, `epub.export`          |
| AI Context        | `src/services/ClaudeService.ts`        | Streaming refactor with summary cache                    |
| Timeline          | `src/components/TimelineInspector.tsx` | Modal visualization                                      |
| Docs & Onboarding | `src/components/Tour/QuickTourV2.tsx`  | Updated onboarding tour                                  |

---

## 4. Testing & Verification

| Category      | Description                                                            |
| ------------- | ---------------------------------------------------------------------- |
| Unit          | autosave debounce, conflict resolution, EPUB builder, AI cache manager |
| Integration   | editor ‚Üí autosave ‚Üí sync loop, EPUB export chain                       |
| E2E           | write session recovery, EPUB export, theme toggle persistence          |
| Performance   | typing latency < 20ms, autosave < 300ms, export < 2s                   |
| Accessibility | ARIA roles, labeled controls, keyboard DnD, focus visibility           |

**Test Coverage Goals:**

- Maintain 735/735 tests passing
- Add 50+ new tests for v0.8.0 features
- Target 75%+ overall coverage (currently 72.31%)

**Performance Benchmarks:**

- Editor typing latency: < 20ms (P95)
- Autosave completion: < 300ms
- EPUB export (100k words): < 2s
- AI streaming first token: < 500ms

---

## 5. Release Plan

| Milestone                  | Target | PRs        | Deliverables                                         |
| -------------------------- | ------ | ---------- | ---------------------------------------------------- |
| Phase 1: Editor + Autosave | Week 1 | PR #26‚Äì#28 | Enhanced editor, autosave service, Topbar indicator  |
| Phase 2: EPUB Export       | Week 2 | PR #29‚Äì#30 | EPUB builder, metadata modal, tests                  |
| Phase 3: AI + Timeline     | Week 3 | PR #31‚Äì#33 | Claude streaming, summary cache, timeline inspector  |
| Phase 4: UX Polish         | Week 4 | PR #34‚Äì#35 | Quick Tour V2, Docs Drawer, E2E tests, release notes |

**Branch Strategy:**

- Create `feat/v0.8.0-editor-autosave` for Phase 1
- Create `feat/v0.8.0-epub-export` for Phase 2
- Create `feat/v0.8.0-ai-streaming` for Phase 3
- Create `feat/v0.8.0-ux-polish` for Phase 4
- Merge all to `main` with final tag `v0.8.0`

---

## 6. Success Metrics (Definition of Done)

‚úÖ **Code Quality:**

- 0 TypeScript errors
- 0 lint warnings
- Full CI pass (all workflows green)

‚úÖ **Functionality:**

- Autosave loop verified: offline ‚Üí sync ‚Üí recovery
- EPUB validated via epubcheck (no warnings)
- Editor latency under 20ms sustained
- AI assistant aware of 3+ chapters

‚úÖ **User Experience:**

- Tour V2 completes onboarding flow (tracked via analytics)
- All tooltips render correctly in light/dark modes
- Command Palette tracks recent commands

‚úÖ **Testing:**

- All E2E tests (‚â•20 tests for v0.8.0 features) pass
- Unit test coverage ‚â• 75%
- Performance benchmarks met

---

## 7. Dependencies & Risks

**External Dependencies:**

- `JSZip` for EPUB packaging
- Claude API streaming (SSE support)
- TipTap editor upgrades (if needed)

**Risks:**
| Risk | Mitigation |
| --------------------------------- | ------------------------------------------------------- |
| Claude API rate limits | Implement queue, cache summaries, add retry logic |
| EPUB validation complexity | Use epubcheck library, add extensive test fixtures |
| Autosave conflicts | Checksum verification, conflict resolver UI |
| Timeline AI detection accuracy | Manual override, user feedback loop |
| Performance regression | Continuous benchmarking, lazy loading, code splitting |

---

## 8. Documentation Requirements

- Update `README.md` with v0.8.0 features
- Create `docs/features/epub-export.md`
- Update `docs/features/export.md` with EPUB details
- Create `docs/dev/autosave-architecture.md`
- Update `docs/dev/ai-services.md` with streaming details
- Create E2E test documentation in `e2e/README.md`
- Update `CHANGELOG.md` with v0.8.0 release notes

---

## 9. Migration Path (from v0.7.1)

**Data Migration:**

- No breaking changes to IndexedDB schema
- Add new fields to Project type: `isbn`, `coverArtUrl`, `epubMetadata`
- Autosave queue stored in separate IndexedDB table

**Feature Flags:**

- `features.epubExport` (default: true)
- `features.aiStreaming` (default: true)
- `features.timelineInspector` (default: false, gradual rollout)

**Backwards Compatibility:**

- All v0.7.1 projects work without modification
- EPUB metadata optional (graceful degradation)
- Timeline inspector works with existing timeline data

---

## 10. Post-Release Plan

**v0.8.1 (2 weeks after v0.8.0):**

- Timeline conflict detection polish
- EPUB cover art generator (AI-assisted)
- Additional export formats (RTF, plain text)

**v0.9.0 (Future):**

- Multi-user collaboration (real-time sync)
- Advanced AI features (character consistency, plot hole detection)
- Mobile-optimized editor

---

**Last Updated:** November 2025
**Maintainers:** @davehail
**Status:** Planning ‚Üí Implementation (Phase 1 starting Week 1)
